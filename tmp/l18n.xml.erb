<%= ERB.new(File.read("geoids.erb"), eoutvar='_sub01').result(binding) %>

<%=

  lookup = {
    'en-US' => '123'
  }

  def lookup(locale)
    ([locale.split('-')]).collect { |system_locale,user_locale|
      "%s@@%s" % [system_locale.to_s.downcase, user_locale.to_s.downcase]
    }
  end
%>

<gs:GlobalizationServices xmlns:gs="urn:longhornGlobalizationUnattend">

  <!-- User List -->
  <gs:UserList>
    <gs:User UserID="Current" CopySettingsToDefaultUserAcct="true" CopySettingsToSystemAcct="true"/>
  </gs:UserList>

  <!-- GeoID
  <gs:LocationPreferences>
    <gs:GeoID Value="249"/>
  </gs:LocationPreferences>
  -->

  <!-- system_locale : <%= node_metadata['system_locale'] %> -->
  <!-- 2-letter locale id -->
  <%=
    (node_metadata['system_locale'].to_s.split(/\s*;\s*/).collect { |locale|
      '<gs:Locale Name="%s" SetAsCurrent="true" ResetAllSettings="true"/>' % lookup(locale)
    }).join('')
  %>

  <!-- ui_language : <%= node_metadata['ui_language'] %> -->
  <!-- 2-letter locale id -->
  <gs:MUILanguagePreferences>
    <%= 
      (node_metadata['ui_language'].to_s.split(/\s*;\s*/).collect { |locale|
        '<gs:MUILanguage Value="%s"/>' % locale
      }).join('')
    %>
  </gs:MUILanguagePreferences>

  <!-- user_locale : <%= node_metadata['user_locale'] %> -->
  <!-- 2-letter locale id -->
  <gs:UserLocale>
    <%=
      (node_metadata['user_locale'].to_s.split(/\s*;\s*/).collect { |locale|
        '<gs:Locale Name="%s" SetAsCurrent="true" ResetAllSettings="true"/>' % locale
      }).join('')
    %>
  </gs:UserLocale>

  <!-- input_locale : <%= node_metadata['input_locale'] %> -->
  <!-- input-locale id -->}
  <gs:InputPreferences>
    <%=
      (node_metadata['input_locale'].to_s.split(/\s*;\s*/).collect { |locale|
        '<gs:InputLanguageID Action="add" ID="%s" Default="true"/>' % locale
      }).join('')
    %>
  </gs:InputPreferences>

</gs:GlobalizationServices>

<!-- control intl.cpl,, /f:"filename.xml" -->
<!-- Dism /online /Add-Package /PackagePath:C:\test\LangPacks\lp.cab -->
<!-- lpksetup.exe /i <%= node_metadata['user_locale'] %> /r /p %SYSTEMDRIVE%\LangPacks -->

